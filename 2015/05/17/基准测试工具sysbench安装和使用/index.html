<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【原创】基准测试工具sysbench安装和使用 | Hexo</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="sysbench介绍SysBench是一个模块化的、跨平台、多线程基准测试工具，主要用于评估测试各种不同系统参数下的数据库负载情况。它主要包括以下几种方式的测试：

cpu性能
磁盘io性能
线程调度性能
互斥锁性能
数据库性能(OLTP基准测试)
内存性能

目前sysbench主要支持 MySQ">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="【原创】基准测试工具sysbench安装和使用"/>
  <meta property="og:site_name" content="Hexo"/>

  
    <meta property="og:image" content="undefined"/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  



</head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Hexo</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class="fa fa-archive"></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class="fa fa-user"></i>About
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">		
			<h1> 【原创】基准测试工具sysbench安装和使用</h1>
		</div>		
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h2 id="sysbench_u4ECB_u7ECD"><a href="#sysbench_u4ECB_u7ECD" class="headerlink" title="sysbench介绍"></a>sysbench介绍</h2><p>SysBench是一个模块化的、跨平台、多线程基准测试工具，主要用于评估测试各种不同系统参数下的数据库负载情况。它主要包括以下几种方式的测试：</p>
<ol>
<li>cpu性能</li>
<li>磁盘io性能</li>
<li>线程调度性能</li>
<li>互斥锁性能</li>
<li>数据库性能(OLTP基准测试)</li>
<li>内存性能</li>
</ol>
<p>目前sysbench主要支持 MySQL、pgsq、Oracle 这3种数据库。<br>  sysbench在github的版本分为两个分支：0.4和0.5。0.4的最新版本是0.4.12，也是我使用的版本。</p>
<blockquote>
<p>github：<a href="https://github.com/akopytov/sysbench" target="_blank" rel="external">https://github.com/akopytov/sysbench</a></p>
</blockquote>
<h2 id="u5B89_u88C5_u73AF_u5883"><a href="#u5B89_u88C5_u73AF_u5883" class="headerlink" title="安装环境"></a>安装环境</h2><p>操作系统：VMware虚拟CentOS 7<br>数据库：MySQL 5.6.24</p>
<h2 id="u5B89_u88C5_u6B65_u9AA4"><a href="#u5B89_u88C5_u6B65_u9AA4" class="headerlink" title="安装步骤"></a>安装步骤</h2><ol>
<li>github下载sysbench的源码zip包：sysbench-0.4.zip到本地目录，如：/home/mahj/software目录下；</li>
<li>在/home/mahj/software目录下运行命令：unzip sysbench-0.4.zip，解压zip包，会生成sysbench-0.4目录；</li>
<li>进入sysbench-0.4目录，运行命令：./autogen.sh。这一步可能会报错：automake 1.10.x (aclocal) wasn’t found, exiting。这说明你的操作系统没有安装automake，运行命令：yum install automake.noarch，即可安装。然后再运行./autogen.sh命令，又报错：libtoolize 1.4+ wasn’t found, exiting。说明你的操作系统没有安装libtool，运行命令：yum install libtool，即可安装。继续运行</li>
<li>运行make命令，可能会报错：drv_mysql.c:35:19: fatal error: mysql.h: No such file or directory。这是因为，你本机没有安装mysql的开发lib库导致的，运行命令：yum install mysql-community-devel.x86_64，即可安装。然后运行make命令，即可正确。</li>
<li>运行make install；</li>
<li>运行sysbench –help测试安装是否正常。</li>
</ol>
<p>命令运行过程如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@bogon sysbench-0.4]# sh autogen.sh&#10;automake 1.10.x (aclocal) wasn&#39;t found, exiting&#10;[root@bogon sysbench-0.4]# yum install automake.noarch&#10;[root@bogon sysbench-0.4]# sh autogen.sh&#10;libtoolize 1.4+ wasn&#39;t found, exiting&#10;[root@bogon sysbench-0.4]# yum install libtool&#10;[root@bogon sysbench-0.4]# sh autogen.sh&#10;[root@bogon sysbench-0.4]# make&#10;Making all in doc&#10;make[1]: Entering directory `/home/mahj/software/sysbench-0.4/doc&#39;&#10;Making all in xsl&#10;make[2]: Entering directory `/home/mahj/software/sysbench-0.4/doc/xsl&#39;&#10;make[2]: Nothing to be done for `all&#39;.&#10;make[2]: Leaving directory `/home/mahj/software/sysbench-0.4/doc/xsl&#39;&#10;make[2]: Entering directory `/home/mahj/software/sysbench-0.4/doc&#39;&#10;touch manual.html&#10;make[2]: Leaving directory `/home/mahj/software/sysbench-0.4/doc&#39;&#10;make[1]: Leaving directory `/home/mahj/software/sysbench-0.4/doc&#39;&#10;Making all in sysbench&#10;make[1]: Entering directory `/home/mahj/software/sysbench-0.4/sysbench&#39;&#10;Making all in drivers&#10;make[2]: Entering directory `/home/mahj/software/sysbench-0.4/sysbench/drivers&#39;&#10;Making all in mysql&#10;make[3]: Entering directory `/home/mahj/software/sysbench-0.4/sysbench/drivers/mysql&#39;&#10;gcc -DHAVE_CONFIG_H -I. -I../../../config  -I/usr/include/mysql -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -fexceptions -fstack-protector-strong --param=ssp-buffer-size=4 -grecord-gcc-switches   -m64 -fPIC  -g -fabi-version=2 -fno-omit-frame-pointer -fno-strict-aliasing -DMY_PTHREAD_FASTMUTEX=1 -I../../../sysbench -D_XOPEN_SOURCE=500 -D_GNU_SOURCE  -W -Wall -Wextra -Wpointer-arith -Wbad-function-cast   -Wstrict-prototypes -Wnested-externs -Winline   -funroll-loops  -Wundef -Wstrict-prototypes -Wmissing-prototypes -Wmissing-declarations -Wredundant-decls -Wcast-align        -pthread -O2 -ggdb3  -MT libsbmysql_a-drv_mysql.o -MD -MP -MF .deps/libsbmysql_a-drv_mysql.Tpo -c -o libsbmysql_a-drv_mysql.o `test -f &#39;drv_mysql.c&#39; || echo &#39;./&#39;`drv_mysql.c&#10;drv_mysql.c:35:19: fatal error: mysql.h: No such file or directory&#10; #include &#60;mysql.h&#62;&#10;                   ^&#10;compilation terminated.&#10;make[3]: *** [libsbmysql_a-drv_mysql.o] Error 1&#10;make[3]: Leaving directory `/home/mahj/software/sysbench-0.4/sysbench/drivers/mysql&#39;&#10;make[2]: *** [all-recursive] Error 1&#10;make[2]: Leaving directory `/home/mahj/software/sysbench-0.4/sysbench/drivers&#39;&#10;make[1]: *** [all-recursive] Error 1&#10;make[1]: Leaving directory `/home/mahj/software/sysbench-0.4/sysbench&#39;&#10;make: *** [all-recursive] Error 1&#10;[root@bogon sysbench-0.4]# yum install mysql-community-devel.x86_64&#10;[root@bogon sysbench-0.4]# make&#10;[root@bogon sysbench-0.4]# make install&#10;[root@bogon sysbench-0.4]# sysbench --help</span><br></pre></td></tr></table></figure></p>
<h2 id="u5E38_u7528_u6D4B_u8BD5_u547D_u4EE4"><a href="#u5E38_u7528_u6D4B_u8BD5_u547D_u4EE4" class="headerlink" title="常用测试命令"></a>常用测试命令</h2><ol>
<li>帮助信息<pre><code>sysbench --help
</code></pre></li>
<li>CPU测试<pre><code>sysbench --test=cpu --cpu-max-prime=2000 run
说明：通过计算2000以内的素数来测试CPU性能。
</code></pre></li>
<li>文件IO测试<ul>
<li>准备文件数据<pre><code>sysbench --test=fileio --num-threads=16 --file-total-size=10G prepare
</code></pre></li>
<li>运行测试<pre><code>sysbench --test=fileio --num-threads=16 --init-rng=on --file-total-size=5G --file-test-mode=rndrw run
</code></pre></li>
<li>读写模式（file-test-mode）包括：<pre><code>seqwr 顺序写入
seqrewr 顺序重写
seqrd 顺序读取
rndrd 随机读取
rndwr 随机写入
rndrw 混合随机读/写
</code></pre></li>
<li>清理测试准备的文件<pre><code>sysbench --test=fileio --num-threads=16 --file-total-size=10G cleanup
</code></pre></li>
</ul>
</li>
<li>线程调度测试<pre><code>sysbench --test=threads --num-threads=64 --thread-yields=100 --thread-locks=2 run
</code></pre></li>
<li>互斥锁测试<pre><code>sysbench --test=mutex --num-threads=16 --mutex-num=1024 --mutex-locks=10000 --mutex-loops=5000 run
说明：模拟所有线程在同一时刻并发运行，并都短暂请求互斥锁。
</code></pre></li>
<li>内存测试<pre><code>sysbench --test=memory --num-threads=16 --memory-block-size=8192 --memory-total-size=1G run
说明：测试内存的连续读写性能。
</code></pre></li>
<li>MySQL数据库测试</li>
</ol>
<ul>
<li>准备表<pre><code>sysbench --test=oltp --oltp-table-size=1000000 --mysql-db=app-db --mysql-user=appuser prepare
说明：用appuser登陆，并在app-db数据库创建sbtest表，其中包含100000万条记录。
</code></pre></li>
<li>运行测试<pre><code>sysbench --test=oltp --oltp-table-size=1000000 --mysql-db=app-db --mysql-user=appuser --max-time=60 --oltp-read-only=on --num-threads=8 run
说明：起8个线程，开启只读模式，执行60秒的测试。
</code></pre></li>
</ul>
	  
	</div>

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/2015/05/25/从无到有：软件项目过程实践/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>上一頁</a></li>
  		

        <li><a href="/archives"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/2015/04/17/基于Netty的“请求-响应”同步通信机制实现/" class="alignright next">下一頁<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">留言</h2>

  
</section>

	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2015-05-17 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/基准测试/">基准测试<span>1</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/MySQL/">MySQL<span>3</span></a></li> <li><a href="/tags/sysbench/">sysbench<span>1</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2016 John Doe
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a>. Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/">Freemind</a>.    
</p> </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
